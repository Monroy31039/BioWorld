"0","# Paso 1: tamaño poblacional estimado por localidad"
"0","Nh_tbl <- predicciones %>%"
"0","  count(Localidad, name = ""N_h"")"
"0",""
"0","# Paso 2: resumen por localidad y unión con tamaños poblacionales"
"0","resultados_basuco_localidad <- predicciones %>%"
"0","  group_by(Localidad) %>%"
"0","  summarise("
"0","    n_h   = n(),                 # tamaño muestral por localidad"
"0","    S_y   = sum(Basuco),         # suma de 1s (consumidores)"
"0","    S_y2  = sum(Basuco),         # para variable binaria, Y^2 = Y"
"0","    .groups = ""drop"""
"0","  ) %>%"
"0","  left_join(Nh_tbl, by = ""Localidad"") %>%"
"0","  mutate("
"0","    # Estimación del total de consumidores en cada localidad"
"0","    T_hat_h     = S_y / pi,"
"0","    Var_T_hat_h = (1/pi) * (1/pi - 1) * S_y2,"
"0","    # Estimación del tamaño poblacional en cada localidad"
"0","    N_hat_h     = n_h / pi,"
"0","    # Proporción (media), varianza y error estándar"
"0","    media_bas    = T_hat_h / N_hat_h,"
"0","    Var_bas    = Var_T_hat_h / (N_hat_h^2),"
"0","    SE_mu_h     = sqrt(Var_bas),"
"0","    CV_bas    = 100 * SE_mu_h / media_bas"
"0","  ) %>%"
"0","  select(Localidad, media_bas, Var_bas, CV_bas) %>%"
"0","  mutate("
"0","    media_bas = round(media_bas,   4),"
"0","    Var_bas = round(Var_bas,   6),"
"0","    CV_bas = round(CV_bas,   2)"
"0","  )"
"0",""
"0","# Mostrar resultados"
"0","print(resultados_basuco_localidad)"
