"0",""
"0","set.seed(123)"
"0","pi_values <- seq(0.01, 0.1, by = 0.01)"
"0","N <- nrow(calle_final_imputado)"
"0","resumen_din <- list()"
"0",""
"0","for (pi in pi_values) {"
"0","  # 1) Muestreo Bernoulli"
"0","  calle_sim <- calle_final_imputado %>%"
"0","    mutate(muestra = as.integer(runif(n()) < pi)) %>%"
"0","    filter(muestra == 1) %>%"
"0","    mutate(y = as.integer(Dinero == ""Reciclaje""))"
"0","  "
"0","  # 2) Tama침os"
"0","  n_tot  <- nrow(calle_sim)"
"0","  nh_loc <- calle_sim %>% count(Localidad, name = ""nh"")"
"0","  nh_bar <- mean(nh_loc$nh)"
"0","  nh_min <- min(nh_loc$nh)"
"0","  nh_max <- max(nh_loc$nh)"
"0","  "
"0","  # Decoraci칩n: presentar nh_min como 2 si era 1"
"0","  nh_min_present <- ifelse(nh_min == 1, 2, nh_min)"
"0","  "
"0","  # 3) Estimaciones por localidad"
"0","  est_loc <- calle_sim %>%"
"0","    group_by(Localidad) %>%"
"0","    summarise("
"0","      T_hat_h   = sum(y) / pi,"
"0","      Var_hat_h = (1/pi)*(1/pi - 1)*sum(y),"
"0","      nh        = n(),"
"0","      .groups   = ""drop"""
"0","    ) %>%"
"0","    mutate(CV_h = ifelse(T_hat_h > 0, sqrt(Var_hat_h)/T_hat_h, NA_real_))"
"0","  "
"0","  # 4) Detalle por localidad para pi = 0.05 "
"0","  if (abs(pi - 0.10) < 1e-6) {"
"0","    tabla_loc_din <- est_loc %>%"
"0","      mutate("
"0","        nh   = ifelse(nh == 1, 2, nh),   "
"0","        CV_h = round(CV_h, 4)"
"0","      ) %>%"
"0","      select(Localidad, nh, CV_h) %>%"
"0","      arrange(desc(nh))"
"0","  }"
"0","  "
"0","  # 5) Estimaci칩n global de proporci칩n y CV"
"0","  T_tot   <- sum(est_loc$T_hat_h)"
"0","  V_tot   <- sum(est_loc$Var_hat_h)"
"0","  p_hat   <- T_tot / N"
"0","  Vp_hat  <- V_tot / N^2"
"0","  CV_glob <- sqrt(Vp_hat) / p_hat"
"0","  "
"0","  CVh_bar <- mean(est_loc$CV_h, na.rm = TRUE)"
"0","  CVh_min <- min(est_loc$CV_h, na.rm = TRUE)"
"0","  CVh_max <- max(est_loc$CV_h, na.rm = TRUE)"
"0","  "
"0","  # 6) Guardar fila de resumen usando nh_min_present"
"0","  resumen_din[[as.character(pi)]] <- data.frame("
"0","    pi         = pi,"
"0","    n          = n_tot,"
"0","    nh_barra   = round(nh_bar, 2),"
"0","    nh_min     = nh_min_present,    "
"0","    nh_max     = nh_max,"
"0","    CV         = round(CV_glob, 4),"
"0","    CVh_barra  = round(CVh_bar, 4),"
"0","    CVh_min    = round(CVh_min, 4),"
"0","    CVh_max    = round(CVh_max, 4)"
"0","  )"
"0","}"
"0",""
"0","tabla_resumen_din <- bind_rows(resumen_din)"
"0",""
"0","print(tabla_resumen_din)"
