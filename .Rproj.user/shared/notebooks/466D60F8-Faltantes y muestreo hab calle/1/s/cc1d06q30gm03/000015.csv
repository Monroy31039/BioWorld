"0","Nh_tbl <- predicciones %>% "
"0","  count(Localidad, name = ""N_h"")"
"0",""
"0","# 2) Para cada localidad, resumimos la muestra y luego unimos N_h"
"0","resultados_por_localidad <- predicciones %>%"
"0","  group_by(Localidad) %>%"
"0","  summarise("
"0","    n_h   = n(),                # tamaño muestral"
"0","    S_y   = sum(Edad),          # suma de Edad"
"0","    S_y2  = sum(Edad^2),        # suma de Edad^2"
"0","    .groups = ""drop"""
"0","  ) %>%"
"0","  left_join(Nh_tbl, by = ""Localidad"") %>%  # añade N_h"
"0","  mutate("
"0","    # Totales estimados en h"
"0","    T_hat_h     = S_y  / pi,"
"0","    Var_T_hat_h = (1/pi) * (1/pi - 1) * S_y2,"
"0","    # Tamaño poblacional estimado en h"
"0","    N_hat_h     = n_h  / pi,"
"0","    # Media, Var y CV en h"
"0","    Edad_prom    = T_hat_h / N_hat_h,"
"0","    Var_edad    = Var_T_hat_h / (N_hat_h^2),"
"0","    SE_mu_h     = sqrt(Var_edad),"
"0","    CV_xL    = SE_mu_h / Edad_prom * 100"
"0","  ) %>%"
"0","  select(Localidad, Edad_prom, Var_edad, CV_xL) %>%"
"0","  mutate("
"0","    Edad_prom = round(Edad_prom,   2),"
"0","    Var_edad = round(Var_edad,   4),"
"0","    CV_xL = round(CV_xL,   2)"
"0","  )"
"0",""
"0","print(resultados_por_localidad)"
