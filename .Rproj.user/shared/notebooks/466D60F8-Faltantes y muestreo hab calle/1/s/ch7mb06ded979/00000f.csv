"0","#    Aquí uso pi_k fijo en 0.05 como antes; ajusta si tienes N real."
"0","datos_imp$pi_k <- 0.05"
"0","datos_imp$d_i  <- 1 / datos_imp$pi_k   # peso de diseño base"
"0",""
"0","# 2) Modelo logístico de propensión con TODAS las auxiliares"
"0","fit_r <- glm(R ~ factor(Localidad) + Edad + "
"0","               factor(Educación) + factor(Dinero) + factor(Tiempo) + "
"0","               factor(Hipertensión) + factor(Diabetes) + factor(Cigarrillo) + "
"0","               factor(Basuco) + factor(Marihuana) + factor(Vida) + factor(Violencia),"
"0","             data = datos_imp,"
"0","             family = binomial)"
"2","Aviso:"
"2"," glm.fit: fitted probabilities numerically 0 or 1 occurred
"
"0","# 3) Probabilidades predichas (propensión a responder)"
"0","datos_imp$phat_raw <- predict(fit_r, type = ""response"")"
"0",""
"0","# Evitar extremos (0 o 1 exactos que rompen el peso)"
"0","lower <- 0.01; upper <- 0.99"
"0","datos_imp$phat <- pmin(pmax(datos_imp$phat_raw, lower), upper)"
"0",""
"0","# 4) Pesos HT modificados (solo para respondientes)"
"0","datos_imp$w_nr <- NA"
"0","respond_idx <- which(datos_imp$R == 1)"
"0","datos_imp$w_nr[respond_idx] <- datos_imp$d_i[respond_idx] / datos_imp$phat[respond_idx]"
"0",""
"0","# 5) Chequeo de resultados"
"0","summary(datos_imp$w_nr)"
"1","   Min. "
"1","1st Qu. "
"1"," Median "
"1","   Mean "
"1","3rd Qu. "
"1","   Max. "
"1","   NA's "
"1","
"
"1","  20.20 "
"1","  20.20 "
"1","  20.20 "
"1","  22.27 "
"1","  21.06 "
"1"," 106.38 "
"1","     69 "
"1","
"
