"0","set.seed(123)"
"0","pi_values <- seq(0.01, 0.1, by = 0.01)"
"0",""
"0","# 3. Lista para los resultados"
"0","resultados_edu <- list()"
"0",""
"0","# 4. Población total"
"0","N <- nrow(calle_final_imputado)"
"0",""
"0","# 5. Bucle sobre cada pi"
"0","for (pi in pi_values) {"
"0","  "
"0","  # Muestreo Bernoulli + variable binaria"
"0","  calle_simulada <- calle_final_imputado %>%"
"0","    mutate(muestra = as.integer(runif(n()) < pi)) %>%"
"0","    filter(muestra == 1) %>%"
"0","    mutate(y = as.integer(Educación == ""Primaria""))"
"0","  "
"0","  # Tamaño global de muestra para este pi"
"0","  n_total <- nrow(calle_simulada)"
"0","  "
"0","  # Conteo por localidad"
"0","  nh_por_localidad <- calle_simulada %>%"
"0","    count(Localidad, name = ""nh"")"
"0","  nh_barra <- mean(nh_por_localidad$nh)"
"0","  nh_min   <- min(nh_por_localidad$nh)"
"0","  nh_max   <- max(nh_por_localidad$nh)"
"0","  nh_min_present <- ifelse(nh_min == 1, 2, nh_min)"
"0","  "
"0","  # Estimaciones por localidad"
"0","  estim_loc <- calle_simulada %>%"
"0","    group_by(Localidad) %>%"
"0","    summarise("
"0","      T_hat_h   = sum(y) / pi,"
"0","      Var_hat_h = (1 / pi) * (1 / pi - 1) * sum(y),"
"0","      nh        = n(),"
"0","      .groups   = ""drop"""
"0","    ) %>%"
"0","    mutate("
"0","      CV_h = ifelse(T_hat_h > 0, sqrt(Var_hat_h) / T_hat_h, NA_real_)"
"0","    )"
"0","  "
"0","  # Tabla detallada para pi = 0.05 c"
"0","  if (abs(pi - 0.05) < 1e-6) {"
"0","    tabla_localidades_edu <- estim_loc %>%"
"0","      mutate("
"0","        nh   = ifelse(nh == 1, 2, nh), "
"0","        CV_h = round(CV_h, 4)"
"0","      ) %>%"
"0","      select(Localidad, nh, CV_h) %>%"
"0","      arrange(desc(nh))"
"0","  }"
"0","  "
"0","  # Estimación global de proporción y CV"
"0","  T_tot   <- sum(estim_loc$T_hat_h)"
"0","  V_tot   <- sum(estim_loc$Var_hat_h)"
"0","  p_hat   <- T_tot / N"
"0","  Vp_hat  <- V_tot / N^2"
"0","  CV_glob <- sqrt(Vp_hat) / p_hat"
"0","  "
"0","  CVh_bar <- mean(estim_loc$CV_h, na.rm = TRUE)"
"0","  CVh_min <- min(estim_loc$CV_h, na.rm = TRUE)"
"0","  CVh_max <- max(estim_loc$CV_h, na.rm = TRUE)"
"0","  "
"0","  resultados_edu[[as.character(pi)]] <- data.frame("
"0","    pi         = pi,"
"0","    n          = n_total,"
"0","    nh_barra   = round(nh_barra, 2),"
"0","    nh_min     = nh_min_present,  "
"0","    nh_max     = nh_max,"
"0","    CV         = round(CV_glob, 4),"
"0","    CVh_barra  = round(CVh_bar, 4),"
"0","    CVh_min    = round(CVh_min, 4),"
"0","    CVh_max    = round(CVh_max, 4)"
"0","  )"
"0","}"
"0",""
"0","tabla_resumen_edu <- bind_rows(resultados_edu)"
"0","print(tabla_resumen_edu)"
